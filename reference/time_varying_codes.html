<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Convert a dataframe of codes with start/stop time to a flat, time-varying covariate format — time_varying_codes • PMDatR</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Convert a dataframe of codes with start/stop time to a flat, time-varying covariate format — time_varying_codes" />
<meta property="og:description" content="Convert a dataframe of codes with start/stop time to a flat, time-varying covariate format" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">PMDatR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/ADDLProcessing.html">ADDL Processing</a>
    </li>
    <li>
      <a href="../articles/BestPracticesforDataManagement.html">Best Practices for Data Management in PMDatR</a>
    </li>
    <li>
      <a href="../articles/CommonErrorsandDiagnostics.html">Common Errors and Diagnostics in PMDatR</a>
    </li>
    <li>
      <a href="../articles/ImportingData.html">Importing Data with PMDatR</a>
    </li>
    <li>
      <a href="../articles/MergingData.html">Merging Data with PMDatR</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Convert a dataframe of codes with start/stop time to a flat, time-varying covariate format</h1>
    
    <div class="hidden name"><code>time_varying_codes.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Convert a dataframe of codes with start/stop time to a flat, time-varying covariate format</p>
    </div>

    <pre class="usage"><span class='fu'>time_varying_codes</span>(<span class='no'>df</span>, <span class='no'>codes</span>, <span class='no'>stdtc</span>, <span class='no'>endtc</span>, <span class='kw'>start_val</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='kw'>end_val</span> <span class='kw'>=</span> <span class='fl'>0</span>,
  <span class='kw'>TIME</span> <span class='kw'>=</span> <span class='st'>"TIME"</span>, <span class='kw'>.sticky</span> <span class='kw'>=</span> <span class='kw'>NULL</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>df</th>
      <td><p>A dataframe (e.g. CM or AE domain)</p></td>
    </tr>
    <tr>
      <th>codes</th>
      <td><p>The name of a column that holds codes that will become columns</p></td>
    </tr>
    <tr>
      <th>stdtc</th>
      <td><p>An expression for the start time (e.g. CMSTDTC)</p></td>
    </tr>
    <tr>
      <th>endtc</th>
      <td><p>An expression for the end time (e.g. iso_to_posix(CMSTDTC, .time="24:00"))</p></td>
    </tr>
    <tr>
      <th>start_val</th>
      <td><p>An expression for the value to assign at the start time</p></td>
    </tr>
    <tr>
      <th>end_val</th>
      <td><p>An expression for the value to assign at the end time</p></td>
    </tr>
    <tr>
      <th>TIME</th>
      <td><p>A name for the new time column</p></td>
    </tr>
    <tr>
      <th>.sticky</th>
      <td><p>A value (set by start_val or end_val) which should be set permanently</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A reformatted dataframe</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The function does the heavy lifting of separating codes into columns that are
flagged at their start and stop times.  The names of the columns are the codes provided in
df.  There is some setup that may be necessary to make proper use of this function:</p><ul>
<li><p>Set grouping before calling.  The groups will be preserved.</p></li>
<li><p>The times are assumed to be POSIXct or numeric.  Conversions can be done using the
   mappings stdtc and endtc.</p></li>
<li><p>Clean up the data to remove duplicate rows and create short codes that will make
   suitable column names.</p></li>
<li><p>filter out codes that are not of interest.  The function will create columns for
   ALL of the codes.</p></li>
<li><p>the output of this function is inteded to be used in a Time-Varying Covariate query.
   Records occurring beyond the limits of the study can be removed there.  The output keeps
   the original data on the rows to aid in further pruning/mapping of the dataset.</p></li>
<li><p>The start_val and end_val mappings can be complex expressions to take into account
   not only the codes, but other columns as well.  The values can be set arbitrarily.</p></li>
</ul>


    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'>if</span> (<span class='fl'>FALSE</span>) {
<span class='no'>cm</span> <span class='kw'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span>(<span class='no'>CMDECOD</span> <span class='kw'>%in%</span> <span class='fu'>.</span>(<span class='no'>ATORVASTATIN</span>,<span class='no'>PARACETAMOL</span>,<span class='no'>IBUPROFEN</span>,<span class='no'>METFORMIN</span>)) <span class='kw'>%&gt;%</span>
  <span class='fu'>group_by</span>(<span class='no'>USUBJID</span>) <span class='kw'>%&gt;%</span>
  <span class='fu'>time_varying_codes</span>(<span class='no'>CMDECOD</span>,
    <span class='fu'>iso_to_posix</span>(<span class='no'>CMSTDTC</span>,<span class='kw'>.time</span> <span class='kw'>=</span> <span class='st'>"00:00"</span>),
    <span class='fu'>iso_to_posix</span>(<span class='no'>CMENDTC</span>,<span class='kw'>.time</span> <span class='kw'>=</span> <span class='st'>"24:00"</span>),
    <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span>(<span class='no'>CMENDTC</span><span class='kw'>==</span><span class='st'>""</span>,<span class='fl'>2</span>,<span class='fl'>1</span>),
    <span class='kw'>.sticky</span> <span class='kw'>=</span> <span class='fl'>2</span>) <span class='kw'>-&gt;</span> <span class='no'>cm.out</span>
}</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Jason Chittenden.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


