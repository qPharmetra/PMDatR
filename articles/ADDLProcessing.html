<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ADDL Processing • PMDatR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="ADDL Processing">
<meta property="og:description" content="PMDatR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">PMDatR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/ADDLProcessing.html">ADDL Processing</a>
    </li>
    <li>
      <a href="../articles/BestPracticesforDataManagement.html">Best Practices for Data Management in PMDatR</a>
    </li>
    <li>
      <a href="../articles/CommonErrorsandDiagnostics.html">Common Errors and Diagnostics in PMDatR</a>
    </li>
    <li>
      <a href="../articles/ImportingData.html">Importing Data with PMDatR</a>
    </li>
    <li>
      <a href="../articles/MergingData.html">Merging Data with PMDatR</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>ADDL Processing</h1>
                        <h4 class="author">qPharmetra, LLC</h4>
            
            <h4 class="date">2020-05-13</h4>
      
      
      <div class="hidden name"><code>ADDLProcessing.Rmd</code></div>

    </div>

    
    
<p>This vignette demonstrates the ADDL features of the PMDatR package. ADDL is a feature in NONMEM whereby a sequence of doses can be specified in a single entry, rather than requiring one record per dose. The ADDL algorithm in PMDatR can be used to compute ADDL sequencing between known dosing records in the sequence (e.g., first and last doses) and allows for additional features such as:</p>
<ul>
<li>allowing a configurable buffer around the penultimate dose in the sequence</li>
<li>expanding ADDL dosing records into individual records</li>
<li>incorporating missed doses</li>
<li>applying the ADDL sequences to different groups of doses (e.g., by compound, period, etc.)</li>
</ul>
<div id="basic-operation" class="section level1">
<h1 class="hasAnchor">
<a href="#basic-operation" class="anchor"></a>Basic Operation</h1>
<p>Dose records are specified with a start time (TIME), dose amount (AMT), event flag (EVID), missing flag indicator (MEX), and interdose interval (II) - at a minimum. The TIME column must be in POSIXct format (an R date/time value). A nonzero II will trigger the ADDL algorithm to fill in ADDL sequencing between dose records having the same II. That is, the doses must have the same II.</p>
<pre><code>## Warning: `data_frame()` is deprecated, use `tibble()`.
## This warning is displayed once per session.</code></pre>
<p>Input Data:</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">ex1</span> <span class="kw">%&gt;%</span> <span class="no">kable</span></pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="left">TIME</th>
<th align="right">AMT</th>
<th align="right">EVID</th>
<th align="right">II</th>
<th align="left">MEX</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">2018-01-01 08:15:00</td>
<td align="right">100</td>
<td align="right">1</td>
<td align="right">24</td>
<td align="left">FALSE</td>
</tr>
<tr class="even">
<td align="left">2018-01-10 10:45:00</td>
<td align="right">100</td>
<td align="right">1</td>
<td align="right">24</td>
<td align="left">FALSE</td>
</tr>
</tbody>
</table>
<p>Output:</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">ex1</span> <span class="kw">%&gt;%</span> <span class="fu">get_addl_dosing</span>() <span class="kw">%&gt;%</span>
  <span class="no">kable</span></pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="left">TIME</th>
<th align="right">AMT</th>
<th align="right">EVID</th>
<th align="right">II</th>
<th align="left">MEX</th>
<th align="right">ADDL</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">2018-01-01 08:15:00</td>
<td align="right">100</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="left">FALSE</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">2018-01-02 10:45:00</td>
<td align="right">100</td>
<td align="right">1</td>
<td align="right">24</td>
<td align="left">FALSE</td>
<td align="right">7</td>
</tr>
<tr class="odd">
<td align="left">2018-01-10 10:45:00</td>
<td align="right">100</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="left">FALSE</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p>The original dose records are unmodified except that II must be set to 0 (NONMEM expects that). An ADDL record is inserted between them with the dose time set to align the final ADDL dose with the next dose record.</p>
<p>Note that if II doesn’t match, the ADDL computation disregards the sequence, but still adjusts II and adds ADDL. Here II is 0 for the second record:</p>
<table class="table">
<thead><tr class="header">
<th align="left">TIME</th>
<th align="right">AMT</th>
<th align="right">EVID</th>
<th align="right">II</th>
<th align="left">MEX</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">2018-01-01 08:15:00</td>
<td align="right">100</td>
<td align="right">1</td>
<td align="right">24</td>
<td align="left">FALSE</td>
</tr>
<tr class="even">
<td align="left">2018-01-10 10:45:00</td>
<td align="right">100</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="left">FALSE</td>
</tr>
</tbody>
</table>
<p>Which produces:</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">ex1</span> <span class="kw">%&gt;%</span> <span class="fu">get_addl_dosing</span>() <span class="kw">%&gt;%</span>
  <span class="no">kable</span></pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="left">TIME</th>
<th align="right">AMT</th>
<th align="right">EVID</th>
<th align="right">II</th>
<th align="left">MEX</th>
<th align="right">ADDL</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">2018-01-01 08:15:00</td>
<td align="right">100</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="left">FALSE</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">2018-01-10 10:45:00</td>
<td align="right">100</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="left">FALSE</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p>And if the dose changes?</p>
<p>Input Data:</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">ex1</span> <span class="kw">%&gt;%</span> <span class="no">kable</span></pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="left">TIME</th>
<th align="right">AMT</th>
<th align="right">EVID</th>
<th align="right">II</th>
<th align="left">MEX</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">2018-01-01 08:15:00</td>
<td align="right">100</td>
<td align="right">1</td>
<td align="right">24</td>
<td align="left">FALSE</td>
</tr>
<tr class="even">
<td align="left">2018-01-10 10:45:00</td>
<td align="right">50</td>
<td align="right">1</td>
<td align="right">24</td>
<td align="left">FALSE</td>
</tr>
<tr class="odd">
<td align="left">2018-01-23 09:30:00</td>
<td align="right">100</td>
<td align="right">1</td>
<td align="right">24</td>
<td align="left">FALSE</td>
</tr>
</tbody>
</table>
<p>Which produces:</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">ex1</span> <span class="kw">%&gt;%</span> <span class="fu">get_addl_dosing</span>() <span class="kw">%&gt;%</span>
  <span class="no">kable</span></pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="left">TIME</th>
<th align="right">AMT</th>
<th align="right">EVID</th>
<th align="right">II</th>
<th align="left">MEX</th>
<th align="right">ADDL</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">2018-01-01 08:15:00</td>
<td align="right">100</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="left">FALSE</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">2018-01-02 10:45:00</td>
<td align="right">100</td>
<td align="right">1</td>
<td align="right">24</td>
<td align="left">FALSE</td>
<td align="right">7</td>
</tr>
<tr class="odd">
<td align="left">2018-01-10 10:45:00</td>
<td align="right">50</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="left">FALSE</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">2018-01-11 09:30:00</td>
<td align="right">50</td>
<td align="right">1</td>
<td align="right">24</td>
<td align="left">FALSE</td>
<td align="right">11</td>
</tr>
<tr class="odd">
<td align="left">2018-01-23 09:30:00</td>
<td align="right">100</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="left">FALSE</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
</div>
<div id="simple-example-with-addl-dosing-starting-exactly-ii-later" class="section level1">
<h1 class="hasAnchor">
<a href="#simple-example-with-addl-dosing-starting-exactly-ii-later" class="anchor"></a>Simple example with addl dosing starting exactly II later</h1>
<p>The first dose record starts the repeated dosing interval. The second dose record ends the interval (because it’s the last dose, not because these need to be paired).</p>
<p>Input Data:</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">ex_dat</span> <span class="kw">&lt;-</span> <span class="kw pkg">tibble</span><span class="kw ns">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span>(
      ~<span class="no">ID</span>,  ~<span class="no">TIME</span>,           ~<span class="no">TRT</span>, ~<span class="no">AMT</span>,    ~<span class="no">FREQ</span>, ~<span class="no">MEX</span>,   ~<span class="no">II</span>, ~<span class="no">EVID</span>,
      <span class="fl">1</span>,    <span class="st">"01/01/2017 10:00"</span>, <span class="st">"A"</span>,    <span class="fl">100</span>,    <span class="st">"QD"</span>,     <span class="fl">FALSE</span>,   <span class="fl">24</span>,   <span class="fl">1</span>,
      <span class="fl">1</span>,    <span class="st">"01/11/2017 10:00"</span>, <span class="st">"A"</span>,    <span class="fl">100</span>,    <span class="st">"QD"</span>,     <span class="fl">FALSE</span>,   <span class="fl">24</span>,   <span class="fl">1</span>
    ) <span class="kw">%&gt;%</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(
      <span class="kw">TIME</span> <span class="kw">=</span> <span class="fu">iso_to_posix</span>(<span class="no">TIME</span>)
    )
<span class="no">ex_dat</span> <span class="kw">%&gt;%</span> <span class="no">kable</span></pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="right">ID</th>
<th align="left">TIME</th>
<th align="left">TRT</th>
<th align="right">AMT</th>
<th align="left">FREQ</th>
<th align="left">MEX</th>
<th align="right">II</th>
<th align="right">EVID</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-01 10:00:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">24</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">2017-01-11 10:00:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">24</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>Modified dosing sheet after ADDL computation. Note that the dose time is the same in both the starting and ending dose of the ADDL block. The first dose on 1/1 is followed by ADDL dosing starting on 1/2 @ 10am with 8 extra doses, which stop on 1/10 @ 10am. Then the final dose is on 1/11 @ 10am.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="fu">get_addl_dosing</span>(<span class="no">ex_dat</span>) <span class="kw">%&gt;%</span> <span class="no">kable</span></pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="right">ID</th>
<th align="left">TIME</th>
<th align="left">TRT</th>
<th align="right">AMT</th>
<th align="left">FREQ</th>
<th align="left">MEX</th>
<th align="right">II</th>
<th align="right">EVID</th>
<th align="right">ADDL</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-01 10:00:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">2017-01-02 10:00:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">24</td>
<td align="right">1</td>
<td align="right">8</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-11 10:00:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
</div>
<div id="simple-example-with-addl-dosing-starting-more-than-ii-later" class="section level1">
<h1 class="hasAnchor">
<a href="#simple-example-with-addl-dosing-starting-more-than-ii-later" class="anchor"></a>Simple example with addl dosing starting more than II later</h1>
<p>We move the final dose back 5 hours.</p>
<p>Input Data:</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">ex_dat</span> <span class="kw">&lt;-</span> <span class="kw pkg">tibble</span><span class="kw ns">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span>(
      ~<span class="no">ID</span>,  ~<span class="no">TIME</span>,           ~<span class="no">TRT</span>, ~<span class="no">AMT</span>,    ~<span class="no">FREQ</span>, ~<span class="no">MEX</span>,   ~<span class="no">II</span>, ~<span class="no">EVID</span>,
      <span class="fl">1</span>,    <span class="st">"01/01/2017 10:00"</span>, <span class="st">"A"</span>,    <span class="fl">100</span>,    <span class="st">"QD"</span>,     <span class="fl">FALSE</span>,   <span class="fl">24</span>,   <span class="fl">1</span>,
      <span class="fl">1</span>,    <span class="st">"01/11/2017 15:00"</span>, <span class="st">"A"</span>,    <span class="fl">100</span>,    <span class="st">"QD"</span>,     <span class="fl">FALSE</span>,   <span class="fl">24</span>,   <span class="fl">1</span>
    ) <span class="kw">%&gt;%</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(
      <span class="kw">TIME</span> <span class="kw">=</span> <span class="fu">iso_to_posix</span>(<span class="no">TIME</span>)
    )
<span class="no">ex_dat</span> <span class="kw">%&gt;%</span> <span class="no">kable</span></pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="right">ID</th>
<th align="left">TIME</th>
<th align="left">TRT</th>
<th align="right">AMT</th>
<th align="left">FREQ</th>
<th align="left">MEX</th>
<th align="right">II</th>
<th align="right">EVID</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-01 10:00:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">24</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">2017-01-11 15:00:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">24</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>Modified dosing sheet after ADDL computation. The first dose on 1/1 is followed by ADDL dosing starting on 1/2 @ 3pm with 8 extra doses, which stop on 1/10 @ 3pm. Then the final dose is on 1/11 @ 3pm.</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="fu">get_addl_dosing</span>(<span class="no">ex_dat</span>) <span class="kw">%&gt;%</span> <span class="no">kable</span></pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="right">ID</th>
<th align="left">TIME</th>
<th align="left">TRT</th>
<th align="right">AMT</th>
<th align="left">FREQ</th>
<th align="left">MEX</th>
<th align="right">II</th>
<th align="right">EVID</th>
<th align="right">ADDL</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-01 10:00:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">2017-01-02 15:00:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">24</td>
<td align="right">1</td>
<td align="right">8</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-11 15:00:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
</div>
<div id="simple-example-with-addl-dosing-starting-less-than-ii-later" class="section level1">
<h1 class="hasAnchor">
<a href="#simple-example-with-addl-dosing-starting-less-than-ii-later" class="anchor"></a>Simple example with addl dosing starting less than II later</h1>
<p>We move the final dose forward 5 hours.</p>
<p>Input Data:</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="no">ex_dat</span> <span class="kw">&lt;-</span> <span class="kw pkg">tibble</span><span class="kw ns">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span>(
      ~<span class="no">ID</span>,  ~<span class="no">TIME</span>,           ~<span class="no">TRT</span>, ~<span class="no">AMT</span>,    ~<span class="no">FREQ</span>, ~<span class="no">MEX</span>,   ~<span class="no">II</span>, ~<span class="no">EVID</span>,
      <span class="fl">1</span>,    <span class="st">"01/01/2017 10:00"</span>, <span class="st">"A"</span>,    <span class="fl">100</span>,    <span class="st">"QD"</span>,     <span class="fl">FALSE</span>,   <span class="fl">24</span>,   <span class="fl">1</span>,
      <span class="fl">1</span>,    <span class="st">"01/11/2017 05:00"</span>, <span class="st">"A"</span>,    <span class="fl">100</span>,    <span class="st">"QD"</span>,     <span class="fl">FALSE</span>,   <span class="fl">24</span>,   <span class="fl">1</span>
    ) <span class="kw">%&gt;%</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(
      <span class="kw">TIME</span> <span class="kw">=</span> <span class="fu">iso_to_posix</span>(<span class="no">TIME</span>)
    )
<span class="no">ex_dat</span> <span class="kw">%&gt;%</span> <span class="no">kable</span></pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="right">ID</th>
<th align="left">TIME</th>
<th align="left">TRT</th>
<th align="right">AMT</th>
<th align="left">FREQ</th>
<th align="left">MEX</th>
<th align="right">II</th>
<th align="right">EVID</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-01 10:00:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">24</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">2017-01-11 05:00:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">24</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>Modified dosing sheet after ADDL computation. Backing up from 1/11 @ 5am, we land on 1/2 @ 5am as the next dose time. This is acceptable because it is 19 hours from the previous dose, a time interval of less than 1/2 of the II (24 hours).</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="fu">get_addl_dosing</span>(<span class="no">ex_dat</span>) <span class="kw">%&gt;%</span> <span class="no">kable</span></pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="right">ID</th>
<th align="left">TIME</th>
<th align="left">TRT</th>
<th align="right">AMT</th>
<th align="left">FREQ</th>
<th align="left">MEX</th>
<th align="right">II</th>
<th align="right">EVID</th>
<th align="right">ADDL</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-01 10:00:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">2017-01-02 05:00:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">24</td>
<td align="right">1</td>
<td align="right">8</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-11 05:00:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
</div>
<div id="simple-example-with-addl-dosing-starting-less-than-12-ii-later" class="section level1">
<h1 class="hasAnchor">
<a href="#simple-example-with-addl-dosing-starting-less-than-12-ii-later" class="anchor"></a>Simple example with addl dosing starting less than 1/2 II later</h1>
<p>Both dose times are modified, so dose times are only 10 hours apart.</p>
<p>Input Data:</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="no">ex_dat</span> <span class="kw">&lt;-</span> <span class="kw pkg">tibble</span><span class="kw ns">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span>(
      ~<span class="no">ID</span>,  ~<span class="no">TIME</span>,           ~<span class="no">TRT</span>, ~<span class="no">AMT</span>,    ~<span class="no">FREQ</span>, ~<span class="no">MEX</span>,   ~<span class="no">II</span>, ~<span class="no">EVID</span>,
      <span class="fl">1</span>,    <span class="st">"01/01/2017 22:00"</span>, <span class="st">"A"</span>,    <span class="fl">100</span>,    <span class="st">"QD"</span>,     <span class="fl">FALSE</span>,   <span class="fl">24</span>,   <span class="fl">1</span>,
      <span class="fl">1</span>,    <span class="st">"01/11/2017 06:00"</span>, <span class="st">"A"</span>,    <span class="fl">100</span>,    <span class="st">"QD"</span>,     <span class="fl">FALSE</span>,   <span class="fl">24</span>,   <span class="fl">1</span>
    ) <span class="kw">%&gt;%</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(
      <span class="kw">TIME</span> <span class="kw">=</span> <span class="fu">iso_to_posix</span>(<span class="no">TIME</span>)
    )
<span class="no">ex_dat</span> <span class="kw">%&gt;%</span> <span class="no">kable</span></pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="right">ID</th>
<th align="left">TIME</th>
<th align="left">TRT</th>
<th align="right">AMT</th>
<th align="left">FREQ</th>
<th align="left">MEX</th>
<th align="right">II</th>
<th align="right">EVID</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-01 22:00:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">24</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">2017-01-11 06:00:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">24</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>A 6am dose on 1/2 is only 10 hours from the initial dose, so the 1/2 dose is skipped and the ADDL sequence starts on 1/3. This reduces ADDL to 7, since skipping the small partial period means we take a whole II to set the next dose.</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="fu">get_addl_dosing</span>(<span class="no">ex_dat</span>) <span class="kw">%&gt;%</span> <span class="no">kable</span></pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="right">ID</th>
<th align="left">TIME</th>
<th align="left">TRT</th>
<th align="right">AMT</th>
<th align="left">FREQ</th>
<th align="left">MEX</th>
<th align="right">II</th>
<th align="right">EVID</th>
<th align="right">ADDL</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-01 22:00:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">2017-01-03 06:00:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">24</td>
<td align="right">1</td>
<td align="right">7</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-11 06:00:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
</div>
<div id="short-dosing-period---same-times" class="section level1">
<h1 class="hasAnchor">
<a href="#short-dosing-period---same-times" class="anchor"></a>Short dosing period - same times</h1>
<p>Same dose times at start and end, exactly two II apart.</p>
<p>Input Data:</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="no">ex_dat</span> <span class="kw">&lt;-</span> <span class="kw pkg">tibble</span><span class="kw ns">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span>(
      ~<span class="no">ID</span>,  ~<span class="no">TIME</span>,           ~<span class="no">TRT</span>, ~<span class="no">AMT</span>,    ~<span class="no">FREQ</span>, ~<span class="no">MEX</span>,   ~<span class="no">II</span>, ~<span class="no">EVID</span>,
      <span class="fl">1</span>,    <span class="st">"01/01/2017 10:00"</span>, <span class="st">"A"</span>,    <span class="fl">100</span>,    <span class="st">"QD"</span>,     <span class="fl">FALSE</span>,   <span class="fl">24</span>,   <span class="fl">1</span>,
      <span class="fl">1</span>,    <span class="st">"01/03/2017 10:00"</span>, <span class="st">"A"</span>,    <span class="fl">100</span>,    <span class="st">"QD"</span>,     <span class="fl">FALSE</span>,   <span class="fl">24</span>,   <span class="fl">1</span>
    ) <span class="kw">%&gt;%</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(
      <span class="kw">TIME</span> <span class="kw">=</span> <span class="fu">iso_to_posix</span>(<span class="no">TIME</span>)
    )
<span class="no">ex_dat</span> <span class="kw">%&gt;%</span> <span class="no">kable</span></pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="right">ID</th>
<th align="left">TIME</th>
<th align="left">TRT</th>
<th align="right">AMT</th>
<th align="left">FREQ</th>
<th align="left">MEX</th>
<th align="right">II</th>
<th align="right">EVID</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-01 10:00:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">24</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">2017-01-03 10:00:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">24</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>There should be one ADDL record on 1/2, but with ADDL set to zero because the ADDL sequence only has one dose.</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="fu">get_addl_dosing</span>(<span class="no">ex_dat</span>) <span class="kw">%&gt;%</span> <span class="no">kable</span></pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="right">ID</th>
<th align="left">TIME</th>
<th align="left">TRT</th>
<th align="right">AMT</th>
<th align="left">FREQ</th>
<th align="left">MEX</th>
<th align="right">II</th>
<th align="right">EVID</th>
<th align="right">ADDL</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-01 10:00:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">2017-01-02 10:00:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-03 10:00:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
</div>
<div id="short-dosing-period---1-5-dose-intervals" class="section level1">
<h1 class="hasAnchor">
<a href="#short-dosing-period---1-5-dose-intervals" class="anchor"></a>Short dosing period - 1.5 dose intervals</h1>
<p>Same dose times at start and end, exactly 1.5 II apart.</p>
<p>Input Data:</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="no">ex_dat</span> <span class="kw">&lt;-</span> <span class="kw pkg">tibble</span><span class="kw ns">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span>(
      ~<span class="no">ID</span>,  ~<span class="no">TIME</span>,           ~<span class="no">TRT</span>, ~<span class="no">AMT</span>,    ~<span class="no">FREQ</span>, ~<span class="no">MEX</span>,   ~<span class="no">II</span>, ~<span class="no">EVID</span>,
      <span class="fl">1</span>,    <span class="st">"01/01/2017 22:00"</span>, <span class="st">"A"</span>,    <span class="fl">100</span>,    <span class="st">"QD"</span>,     <span class="fl">FALSE</span>,   <span class="fl">24</span>,   <span class="fl">1</span>,
      <span class="fl">1</span>,    <span class="st">"01/03/2017 10:00"</span>, <span class="st">"A"</span>,    <span class="fl">100</span>,    <span class="st">"QD"</span>,     <span class="fl">FALSE</span>,   <span class="fl">24</span>,   <span class="fl">1</span>
    ) <span class="kw">%&gt;%</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(
      <span class="kw">TIME</span> <span class="kw">=</span> <span class="fu">iso_to_posix</span>(<span class="no">TIME</span>)
    )
<span class="no">ex_dat</span> <span class="kw">%&gt;%</span> <span class="no">kable</span></pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="right">ID</th>
<th align="left">TIME</th>
<th align="left">TRT</th>
<th align="right">AMT</th>
<th align="left">FREQ</th>
<th align="left">MEX</th>
<th align="right">II</th>
<th align="right">EVID</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-01 22:00:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">24</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">2017-01-03 10:00:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">24</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>There should be one ADDL record on 1/2, but with ADDL set to zero because the ADDL sequence only has one dose. This is the limit of our tolerance for the extra dose.</p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="fu">get_addl_dosing</span>(<span class="no">ex_dat</span>) <span class="kw">%&gt;%</span> <span class="no">kable</span></pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="right">ID</th>
<th align="left">TIME</th>
<th align="left">TRT</th>
<th align="right">AMT</th>
<th align="left">FREQ</th>
<th align="left">MEX</th>
<th align="right">II</th>
<th align="right">EVID</th>
<th align="right">ADDL</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-01 22:00:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">2017-01-02 10:00:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-03 10:00:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
</div>
<div id="short-dosing-interval---two-subjects-right-around-the-ii-tolerance" class="section level1">
<h1 class="hasAnchor">
<a href="#short-dosing-interval---two-subjects-right-around-the-ii-tolerance" class="anchor"></a>Short dosing interval - two subjects, right around the II tolerance</h1>
<p>Duplicate previous example, but ID=1 is just above the the II tolerance, ID=2 is just below.</p>
<p>Input Data:</p>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="no">ex_dat</span> <span class="kw">&lt;-</span> <span class="kw pkg">tibble</span><span class="kw ns">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span>(
      ~<span class="no">ID</span>,  ~<span class="no">TIME</span>,           ~<span class="no">TRT</span>, ~<span class="no">AMT</span>,    ~<span class="no">FREQ</span>, ~<span class="no">MEX</span>,   ~<span class="no">II</span>, ~<span class="no">EVID</span>,
      <span class="fl">1</span>,    <span class="st">"01/01/2017 21:59"</span>, <span class="st">"A"</span>,    <span class="fl">100</span>,    <span class="st">"QD"</span>,     <span class="fl">FALSE</span>,   <span class="fl">24</span>,   <span class="fl">1</span>,
      <span class="fl">1</span>,    <span class="st">"01/03/2017 10:00"</span>, <span class="st">"A"</span>,    <span class="fl">100</span>,    <span class="st">"QD"</span>,     <span class="fl">FALSE</span>,   <span class="fl">24</span>,   <span class="fl">1</span>,
      <span class="fl">2</span>,    <span class="st">"01/01/2017 22:01"</span>, <span class="st">"A"</span>,    <span class="fl">100</span>,    <span class="st">"QD"</span>,     <span class="fl">FALSE</span>,   <span class="fl">24</span>,   <span class="fl">1</span>,
      <span class="fl">2</span>,    <span class="st">"01/03/2017 10:00"</span>, <span class="st">"A"</span>,    <span class="fl">100</span>,    <span class="st">"QD"</span>,     <span class="fl">FALSE</span>,   <span class="fl">24</span>,   <span class="fl">1</span>
    ) <span class="kw">%&gt;%</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(
      <span class="kw">TIME</span> <span class="kw">=</span> <span class="fu">iso_to_posix</span>(<span class="no">TIME</span>)
    )
<span class="no">ex_dat</span> <span class="kw">%&gt;%</span> <span class="no">kable</span></pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="right">ID</th>
<th align="left">TIME</th>
<th align="left">TRT</th>
<th align="right">AMT</th>
<th align="left">FREQ</th>
<th align="left">MEX</th>
<th align="right">II</th>
<th align="right">EVID</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-01 21:59:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">24</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">2017-01-03 10:00:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">24</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="left">2017-01-01 22:01:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">24</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">2017-01-03 10:00:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">24</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>ID=1 gets an ADDL dose. ID=2 does not. This is probably the most concerning edge case, and an example of why we should record the 3 previous dose times leading up to a PK day. If we have actual doses before a PK day then this ADDL algorithm will have minimal effect.</p>
<p>NOTE: we ask for QD dosing, but for ID=2 the 1/2 dose is skipped due to the II tolerance (currently set at 50%). We can’t give a dose at 10am because it is within 12 hours of the previous dose, so in order to start the ADDL dosing at the correct time we have to skip forward an entire day, which puts us at the final dose anyway.</p>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="fu">get_addl_dosing</span>(<span class="no">ex_dat</span>) <span class="kw">%&gt;%</span> <span class="fu">arrange</span>(<span class="no">ID</span>, <span class="no">TIME</span>) <span class="kw">%&gt;%</span> <span class="no">kable</span></pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="right">ID</th>
<th align="left">TIME</th>
<th align="left">TRT</th>
<th align="right">AMT</th>
<th align="left">FREQ</th>
<th align="left">MEX</th>
<th align="right">II</th>
<th align="right">EVID</th>
<th align="right">ADDL</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-01 21:59:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">2017-01-02 10:00:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-03 10:00:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">2017-01-01 22:01:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="left">2017-01-03 10:00:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
</div>
<div id="short-dosing-interval---two-subjects-lower-ii-tolerance-" class="section level1">
<h1 class="hasAnchor">
<a href="#short-dosing-interval---two-subjects-lower-ii-tolerance-" class="anchor"></a>Short dosing interval - two subjects, lower II tolerance.</h1>
<p>Change the II tolerance from 0.5 (default) to 0.375 (9 hours for QD). Now the second subject gets the ADDL dose at 10 am.</p>
<div class="sourceCode" id="cb21"><html><body><pre class="r"><span class="fu">get_addl_dosing</span>(<span class="no">ex_dat</span>, <span class="kw">.tolII</span> <span class="kw">=</span> <span class="fl">0.375</span>) <span class="kw">%&gt;%</span> <span class="fu">arrange</span>(<span class="no">ID</span>, <span class="no">TIME</span>) <span class="kw">%&gt;%</span> <span class="no">kable</span></pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="right">ID</th>
<th align="left">TIME</th>
<th align="left">TRT</th>
<th align="right">AMT</th>
<th align="left">FREQ</th>
<th align="left">MEX</th>
<th align="right">II</th>
<th align="right">EVID</th>
<th align="right">ADDL</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-01 21:59:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">2017-01-02 10:00:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-03 10:00:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">2017-01-01 22:01:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="left">2017-01-02 10:00:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">2017-01-03 10:00:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
</div>
<div id="simple-example-with-final-3-actual-doses" class="section level1">
<h1 class="hasAnchor">
<a href="#simple-example-with-final-3-actual-doses" class="anchor"></a>Simple example with final 3 actual doses</h1>
<p>The first dose record starts the repeated dosing interval. Then we have 3 additional doses leading up to the PK day. We should see ADDL dosing starting on <a href="mailto:1/2@9">1/2@9</a>:15am and running for 8 additional doses. Then the individual doses should show up. It doesn’t matter that they are still marked with II=24… unless there is a large enough gap to restart ADDL sequencing.</p>
<p>Input Data:</p>
<div class="sourceCode" id="cb22"><html><body><pre class="r"><span class="no">ex_dat</span> <span class="kw">&lt;-</span> <span class="kw pkg">tibble</span><span class="kw ns">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span>(
      ~<span class="no">ID</span>,  ~<span class="no">TIME</span>,           ~<span class="no">TRT</span>, ~<span class="no">AMT</span>,    ~<span class="no">FREQ</span>, ~<span class="no">MEX</span>,   ~<span class="no">II</span>, ~<span class="no">EVID</span>,
      <span class="fl">1</span>,    <span class="st">"01/01/2017 10:00"</span>, <span class="st">"A"</span>,    <span class="fl">100</span>,    <span class="st">"QD"</span>,     <span class="fl">FALSE</span>,   <span class="fl">24</span>,   <span class="fl">1</span>,
      <span class="fl">1</span>,    <span class="st">"01/11/2017 09:15"</span>, <span class="st">"A"</span>,    <span class="fl">100</span>,    <span class="st">"QD"</span>,     <span class="fl">FALSE</span>,   <span class="fl">24</span>,   <span class="fl">1</span>,
      <span class="fl">1</span>,    <span class="st">"01/12/2017 10:21"</span>, <span class="st">"A"</span>,    <span class="fl">100</span>,    <span class="st">"QD"</span>,     <span class="fl">FALSE</span>,   <span class="fl">24</span>,   <span class="fl">1</span>,
      <span class="fl">1</span>,    <span class="st">"01/13/2017 08:37"</span>, <span class="st">"A"</span>,    <span class="fl">100</span>,    <span class="st">"QD"</span>,     <span class="fl">FALSE</span>,   <span class="fl">24</span>,   <span class="fl">1</span>
    ) <span class="kw">%&gt;%</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(
      <span class="kw">TIME</span> <span class="kw">=</span> <span class="fu">iso_to_posix</span>(<span class="no">TIME</span>)
    )
<span class="no">ex_dat</span> <span class="kw">%&gt;%</span> <span class="no">kable</span></pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="right">ID</th>
<th align="left">TIME</th>
<th align="left">TRT</th>
<th align="right">AMT</th>
<th align="left">FREQ</th>
<th align="left">MEX</th>
<th align="right">II</th>
<th align="right">EVID</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-01 10:00:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">24</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">2017-01-11 09:15:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">24</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-12 10:21:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">24</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">2017-01-13 08:37:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">24</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>As expected, the ADDL dosing fills in between 1/2 and 1/10 only and lines up qith 1/11 dose time.</p>
<div class="sourceCode" id="cb23"><html><body><pre class="r"><span class="fu">get_addl_dosing</span>(<span class="no">ex_dat</span>) <span class="kw">%&gt;%</span> <span class="no">kable</span></pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="right">ID</th>
<th align="left">TIME</th>
<th align="left">TRT</th>
<th align="right">AMT</th>
<th align="left">FREQ</th>
<th align="left">MEX</th>
<th align="right">II</th>
<th align="right">EVID</th>
<th align="right">ADDL</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-01 10:00:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">2017-01-02 09:15:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">24</td>
<td align="right">1</td>
<td align="right">8</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-11 09:15:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">2017-01-12 10:21:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-13 08:37:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
</div>
<div id="simple-example-with-final-3-actual-doses-dosing-period-causes-addl-restart" class="section level1">
<h1 class="hasAnchor">
<a href="#simple-example-with-final-3-actual-doses-dosing-period-causes-addl-restart" class="anchor"></a>Simple example with final 3 actual doses, dosing period causes ADDL restart</h1>
<p>The first dose record starts the repeated dosing interval. Then we have 3 additional doses leading up to the PK day. We should see ADDL dosing starting on <a href="mailto:1/2@9">1/2@9</a>:15am and running for 8 additional doses. Then the individual doses should show up. I doesn’t matter that they are still marked with II=24… unless there is a large enough gap to restart ADDL sequencing.</p>
<p>Input Data:</p>
<div class="sourceCode" id="cb24"><html><body><pre class="r"><span class="no">ex_dat</span> <span class="kw">&lt;-</span> <span class="kw pkg">tibble</span><span class="kw ns">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span>(
      ~<span class="no">ID</span>,  ~<span class="no">TIME</span>,           ~<span class="no">TRT</span>, ~<span class="no">AMT</span>,    ~<span class="no">FREQ</span>, ~<span class="no">MEX</span>,   ~<span class="no">II</span>, ~<span class="no">EVID</span>,
      <span class="fl">1</span>,    <span class="st">"01/01/2017 10:00"</span>, <span class="st">"A"</span>,    <span class="fl">100</span>,    <span class="st">"QD"</span>,     <span class="fl">FALSE</span>,   <span class="fl">24</span>,   <span class="fl">1</span>,
      <span class="fl">1</span>,    <span class="st">"01/11/2017 09:15"</span>, <span class="st">"A"</span>,    <span class="fl">100</span>,    <span class="st">"QD"</span>,     <span class="fl">FALSE</span>,   <span class="fl">24</span>,   <span class="fl">1</span>,
      <span class="fl">1</span>,    <span class="st">"01/12/2017 05:21"</span>, <span class="st">"A"</span>,    <span class="fl">100</span>,    <span class="st">"QD"</span>,     <span class="fl">FALSE</span>,   <span class="fl">24</span>,   <span class="fl">1</span>,
      <span class="fl">1</span>,    <span class="st">"01/13/2017 17:37"</span>, <span class="st">"A"</span>,    <span class="fl">100</span>,    <span class="st">"QD"</span>,     <span class="fl">FALSE</span>,   <span class="fl">24</span>,   <span class="fl">1</span>
    ) <span class="kw">%&gt;%</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(
      <span class="kw">TIME</span> <span class="kw">=</span> <span class="fu">iso_to_posix</span>(<span class="no">TIME</span>)
    )
<span class="no">ex_dat</span> <span class="kw">%&gt;%</span> <span class="no">kable</span></pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="right">ID</th>
<th align="left">TIME</th>
<th align="left">TRT</th>
<th align="right">AMT</th>
<th align="left">FREQ</th>
<th align="left">MEX</th>
<th align="right">II</th>
<th align="right">EVID</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-01 10:00:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">24</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">2017-01-11 09:15:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">24</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-12 05:21:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">24</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">2017-01-13 17:37:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">24</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>BUT THERE IS A GAP HERE, the dosing period from 1/12 to 1/13 is over 36 hours so we get an ADDL dose filling in on 1/12!</p>
<div class="sourceCode" id="cb25"><html><body><pre class="r"><span class="fu">get_addl_dosing</span>(<span class="no">ex_dat</span>) <span class="kw">%&gt;%</span> <span class="no">kable</span></pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="right">ID</th>
<th align="left">TIME</th>
<th align="left">TRT</th>
<th align="right">AMT</th>
<th align="left">FREQ</th>
<th align="left">MEX</th>
<th align="right">II</th>
<th align="right">EVID</th>
<th align="right">ADDL</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-01 10:00:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">2017-01-02 09:15:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">24</td>
<td align="right">1</td>
<td align="right">8</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-11 09:15:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">2017-01-12 05:21:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-12 17:37:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">2017-01-13 17:37:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
</div>
<div id="simple-example-with-final-3-actual-doses-set-actual-doses-with-freqonce" class="section level1">
<h1 class="hasAnchor">
<a href="#simple-example-with-final-3-actual-doses-set-actual-doses-with-freqonce" class="anchor"></a>Simple example with final 3 actual doses, set actual doses with FREQ=ONCE</h1>
<p>The first dose record starts the repeated dosing interval. Then we have 3 additional doses leading up to the PK day. We should see ADDL dosing starting on <a href="mailto:1/2@9">1/2@9</a>:15am and running for 8 additional doses. Then the individual doses should show up. Now the final dose is marked with FREQ=ONCE (which get’s translated in mappings to II=0) so it won’t allow ADDL sequencing running up to it.</p>
<p>Input Data:</p>
<div class="sourceCode" id="cb26"><html><body><pre class="r"><span class="no">ex_dat</span> <span class="kw">&lt;-</span> <span class="kw pkg">tibble</span><span class="kw ns">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span>(
      ~<span class="no">ID</span>,  ~<span class="no">TIME</span>,           ~<span class="no">TRT</span>, ~<span class="no">AMT</span>,    ~<span class="no">FREQ</span>, ~<span class="no">MEX</span>,   ~<span class="no">II</span>, ~<span class="no">EVID</span>,
      <span class="fl">1</span>,    <span class="st">"01/01/2017 10:00"</span>, <span class="st">"A"</span>,    <span class="fl">100</span>,    <span class="st">"QD"</span>,     <span class="fl">FALSE</span>,   <span class="fl">24</span>,   <span class="fl">1</span>,
      <span class="fl">1</span>,    <span class="st">"01/11/2017 09:15"</span>, <span class="st">"A"</span>,    <span class="fl">100</span>,    <span class="st">"QD"</span>,     <span class="fl">FALSE</span>,   <span class="fl">24</span>,   <span class="fl">1</span>,
      <span class="fl">1</span>,    <span class="st">"01/12/2017 05:21"</span>, <span class="st">"A"</span>,    <span class="fl">100</span>,    <span class="st">"QD"</span>,     <span class="fl">FALSE</span>,   <span class="fl">24</span>,   <span class="fl">1</span>,
      <span class="fl">1</span>,    <span class="st">"01/13/2017 17:37"</span>, <span class="st">"A"</span>,    <span class="fl">100</span>,    <span class="st">"ONCE"</span>,   <span class="fl">FALSE</span>,   <span class="fl">0</span>,   <span class="fl">1</span>
    ) <span class="kw">%&gt;%</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(
      <span class="kw">TIME</span> <span class="kw">=</span> <span class="fu">iso_to_posix</span>(<span class="no">TIME</span>)
    )
<span class="no">ex_dat</span> <span class="kw">%&gt;%</span> <span class="no">kable</span></pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="right">ID</th>
<th align="left">TIME</th>
<th align="left">TRT</th>
<th align="right">AMT</th>
<th align="left">FREQ</th>
<th align="left">MEX</th>
<th align="right">II</th>
<th align="right">EVID</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-01 10:00:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">24</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">2017-01-11 09:15:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">24</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-12 05:21:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">24</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">2017-01-13 17:37:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">ONCE</td>
<td align="left">FALSE</td>
<td align="right">0</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>ADDL sequencing runs between doses marked with II&gt;0. A dose with II==0 is a single dose and ADDL sequencing won’t run to it - even if the previous dose is marked with II&gt;0.</p>
<p>NOTE: this may be something we want to change. It doesn’t affect timing of ADDL, but it does affect how we tag the EX data II values. It may be difficult to figure out the FREQ/II values.</p>
<div class="sourceCode" id="cb27"><html><body><pre class="r"><span class="fu">get_addl_dosing</span>(<span class="no">ex_dat</span>) <span class="kw">%&gt;%</span> <span class="no">kable</span></pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="right">ID</th>
<th align="left">TIME</th>
<th align="left">TRT</th>
<th align="right">AMT</th>
<th align="left">FREQ</th>
<th align="left">MEX</th>
<th align="right">II</th>
<th align="right">EVID</th>
<th align="right">ADDL</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-01 10:00:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">2017-01-02 09:15:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">24</td>
<td align="right">1</td>
<td align="right">8</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-11 09:15:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">2017-01-12 05:21:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-13 17:37:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">ONCE</td>
<td align="left">FALSE</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
</div>
<div id="simple-example-with-final-3-actual-doses-one-of-them-is-missed" class="section level1">
<h1 class="hasAnchor">
<a href="#simple-example-with-final-3-actual-doses-one-of-them-is-missed" class="anchor"></a>Simple example with final 3 actual doses, one of them is missed!</h1>
<p>The first dose record starts the repeated dosing interval. Then we have 3 additional doses leading up to the PK day. We should see ADDL dosing starting on <a href="mailto:1/2@9">1/2@9</a>:15am and running for 8 additional doses. Then we have the missed dose recorded on 1/12 at the same clock time as the previous dose (this is determined in mappings, since the missed dose is probably missing a time in EXSTDTC). Note that we have to enter AMT=0 for the missed dose.</p>
<p>Input Data:</p>
<div class="sourceCode" id="cb28"><html><body><pre class="r"><span class="no">ex_dat</span> <span class="kw">&lt;-</span> <span class="kw pkg">tibble</span><span class="kw ns">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span>(
      ~<span class="no">ID</span>,  ~<span class="no">TIME</span>,           ~<span class="no">TRT</span>, ~<span class="no">AMT</span>,    ~<span class="no">FREQ</span>, ~<span class="no">MEX</span>,   ~<span class="no">II</span>, ~<span class="no">EVID</span>,
      <span class="fl">1</span>,    <span class="st">"01/01/2017 10:00"</span>, <span class="st">"A"</span>,    <span class="fl">100</span>,    <span class="st">"QD"</span>,     <span class="fl">FALSE</span>,   <span class="fl">24</span>,   <span class="fl">1</span>,
      <span class="fl">1</span>,    <span class="st">"01/11/2017 09:15"</span>, <span class="st">"A"</span>,    <span class="fl">100</span>,    <span class="st">"QD"</span>,     <span class="fl">FALSE</span>,   <span class="fl">24</span>,   <span class="fl">1</span>,
      <span class="fl">1</span>,    <span class="st">"01/12/2017 09:15"</span>, <span class="st">"A"</span>,    <span class="fl">0</span>,  <span class="st">"QD"</span>,     <span class="fl">TRUE</span>,   <span class="fl">24</span>,   <span class="fl">1</span>,
      <span class="fl">1</span>,    <span class="st">"01/13/2017 08:37"</span>, <span class="st">"A"</span>,    <span class="fl">100</span>,    <span class="st">"QD"</span>,     <span class="fl">FALSE</span>,   <span class="fl">24</span>,   <span class="fl">1</span>
    ) <span class="kw">%&gt;%</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(
      <span class="kw">TIME</span> <span class="kw">=</span> <span class="fu">iso_to_posix</span>(<span class="no">TIME</span>)
    )
<span class="no">ex_dat</span> <span class="kw">%&gt;%</span> <span class="no">kable</span></pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="right">ID</th>
<th align="left">TIME</th>
<th align="left">TRT</th>
<th align="right">AMT</th>
<th align="left">FREQ</th>
<th align="left">MEX</th>
<th align="right">II</th>
<th align="right">EVID</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-01 10:00:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">24</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">2017-01-11 09:15:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">24</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-12 09:15:00</td>
<td align="left">A</td>
<td align="right">0</td>
<td align="left">QD</td>
<td align="left">TRUE</td>
<td align="right">24</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">2017-01-13 08:37:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">24</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>As expected, the ADDL dosing fills in between 1/2 and 1/10 only and lines up with 1/11 dose time. Missed dose on 1/12 is backfilled by ADDL from 1/13 but is AMT 0.</p>
<div class="sourceCode" id="cb29"><html><body><pre class="r"><span class="fu">get_addl_dosing</span>(<span class="no">ex_dat</span>) <span class="kw">%&gt;%</span> <span class="no">kable</span></pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="right">ID</th>
<th align="left">TIME</th>
<th align="left">TRT</th>
<th align="right">AMT</th>
<th align="left">FREQ</th>
<th align="left">MEX</th>
<th align="right">II</th>
<th align="right">EVID</th>
<th align="right">ADDL</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-01 10:00:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">2017-01-02 09:15:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">24</td>
<td align="right">1</td>
<td align="right">8</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-11 09:15:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">2017-01-12 09:15:00</td>
<td align="left">A</td>
<td align="right">0</td>
<td align="left">QD</td>
<td align="left">TRUE</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-13 08:37:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
</div>
<div id="dont-use-addl-between-cycles" class="section level1">
<h1 class="hasAnchor">
<a href="#dont-use-addl-between-cycles" class="anchor"></a>Don’t use ADDL between cycles</h1>
<p>Starting in CYCLE1 with QD dosing until day 11. Then restart in CYCLE2 on 2/1 until 2/13.</p>
<p>Input Data:</p>
<div class="sourceCode" id="cb30"><html><body><pre class="r"><span class="no">ex_dat</span> <span class="kw">&lt;-</span> <span class="kw pkg">tibble</span><span class="kw ns">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span>(
      ~<span class="no">ID</span>,  ~<span class="no">TIME</span>,           ~<span class="no">CYCLE</span>, ~<span class="no">AMT</span>,  ~<span class="no">FREQ</span>, ~<span class="no">MEX</span>,   ~<span class="no">II</span>, ~<span class="no">EVID</span>,
      <span class="fl">1</span>,    <span class="st">"01/01/2017 10:00"</span>, <span class="st">"CYCLE1"</span>,   <span class="fl">100</span>,    <span class="st">"QD"</span>,     <span class="fl">FALSE</span>,   <span class="fl">24</span>,   <span class="fl">1</span>,
      <span class="fl">1</span>,    <span class="st">"01/11/2017 09:15"</span>, <span class="st">"CYCLE1"</span>,   <span class="fl">100</span>,    <span class="st">"QD"</span>,     <span class="fl">FALSE</span>,   <span class="fl">24</span>,   <span class="fl">1</span>,
      <span class="fl">1</span>,    <span class="st">"02/01/2017 09:15"</span>, <span class="st">"CYCLE2"</span>,   <span class="fl">100</span>,    <span class="st">"QD"</span>,     <span class="fl">FALSE</span>,   <span class="fl">24</span>,   <span class="fl">1</span>,
      <span class="fl">1</span>,    <span class="st">"02/13/2017 08:37"</span>, <span class="st">"CYCLE2"</span>,   <span class="fl">100</span>,    <span class="st">"QD"</span>,     <span class="fl">FALSE</span>,   <span class="fl">24</span>,   <span class="fl">1</span>
    ) <span class="kw">%&gt;%</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(
      <span class="kw">TIME</span> <span class="kw">=</span> <span class="fu">iso_to_posix</span>(<span class="no">TIME</span>)
    )
<span class="no">ex_dat</span> <span class="kw">%&gt;%</span> <span class="no">kable</span></pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="right">ID</th>
<th align="left">TIME</th>
<th align="left">CYCLE</th>
<th align="right">AMT</th>
<th align="left">FREQ</th>
<th align="left">MEX</th>
<th align="right">II</th>
<th align="right">EVID</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-01 10:00:00</td>
<td align="left">CYCLE1</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">24</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">2017-01-11 09:15:00</td>
<td align="left">CYCLE1</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">24</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-02-01 09:15:00</td>
<td align="left">CYCLE2</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">24</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">2017-02-13 08:37:00</td>
<td align="left">CYCLE2</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">24</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>Output:</p>
<div class="sourceCode" id="cb31"><html><body><pre class="r"><span class="no">ex_dat</span> <span class="kw">%&gt;%</span>  <span class="fu">group_by</span>(<span class="no">ID</span>,<span class="no">CYCLE</span>) <span class="kw">%&gt;%</span> <span class="fu">get_addl_dosing</span>() <span class="kw">%&gt;%</span> <span class="no">kable</span></pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="right">ID</th>
<th align="left">TIME</th>
<th align="left">CYCLE</th>
<th align="right">AMT</th>
<th align="left">FREQ</th>
<th align="left">MEX</th>
<th align="right">II</th>
<th align="right">EVID</th>
<th align="right">ADDL</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-01 10:00:00</td>
<td align="left">CYCLE1</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">2017-01-02 09:15:00</td>
<td align="left">CYCLE1</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">24</td>
<td align="right">1</td>
<td align="right">8</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-11 09:15:00</td>
<td align="left">CYCLE1</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">2017-02-01 09:15:00</td>
<td align="left">CYCLE2</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-02-02 08:37:00</td>
<td align="left">CYCLE2</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">24</td>
<td align="right">1</td>
<td align="right">10</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">2017-02-13 08:37:00</td>
<td align="left">CYCLE2</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
</div>
<div id="missed-doses-in-sequence" class="section level1">
<h1 class="hasAnchor">
<a href="#missed-doses-in-sequence" class="anchor"></a>Missed doses in sequence</h1>
<p>The first dose record starts the repeated dosing interval for 31 days. But we have 2 missing doses. We should see ADDL dosing starting on <a href="mailto:1/2@8">1/2@8</a>:37am and running for 8 additional doses. Then we have the missed dose recorded on 1/12 at the same clock time as the previous dose (this is determined in mappings, since the missed dose is probably missing a time in EXSTDTC). Note that we have to enter AMT=0 for the missed dose. After last missed dose, ADDL is restarted with 17 additional doses to arrive at 1/30.</p>
<p>Input Data:</p>
<div class="sourceCode" id="cb32"><html><body><pre class="r"><span class="no">ex_dat</span> <span class="kw">&lt;-</span> <span class="kw pkg">tibble</span><span class="kw ns">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span>(
      ~<span class="no">ID</span>,  ~<span class="no">TIME</span>,           ~<span class="no">TRT</span>, ~<span class="no">AMT</span>,    ~<span class="no">FREQ</span>, ~<span class="no">MEX</span>,   ~<span class="no">II</span>, ~<span class="no">EVID</span>,
      <span class="fl">1</span>,    <span class="st">"01/01/2017 10:00"</span>, <span class="st">"A"</span>,    <span class="fl">100</span>,    <span class="st">"QD"</span>,     <span class="fl">FALSE</span>,   <span class="fl">24</span>,   <span class="fl">1</span>,
      <span class="fl">1</span>,    <span class="st">"01/11/2017 09:15"</span>, <span class="st">"A"</span>,    <span class="fl">0</span>,  <span class="st">"QD"</span>,     <span class="fl">TRUE</span>,   <span class="fl">24</span>,   <span class="fl">1</span>,
      <span class="fl">1</span>,    <span class="st">"01/12/2017 09:15"</span>, <span class="st">"A"</span>,    <span class="fl">0</span>,  <span class="st">"QD"</span>,     <span class="fl">TRUE</span>,   <span class="fl">24</span>,   <span class="fl">1</span>,
      <span class="fl">1</span>,    <span class="st">"01/31/2017 08:37"</span>, <span class="st">"A"</span>,    <span class="fl">100</span>,    <span class="st">"QD"</span>,     <span class="fl">FALSE</span>,   <span class="fl">24</span>,   <span class="fl">1</span>
    ) <span class="kw">%&gt;%</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(
      <span class="kw">TIME</span> <span class="kw">=</span> <span class="fu">iso_to_posix</span>(<span class="no">TIME</span>)
    )
<span class="no">ex_dat</span> <span class="kw">%&gt;%</span> <span class="no">kable</span></pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="right">ID</th>
<th align="left">TIME</th>
<th align="left">TRT</th>
<th align="right">AMT</th>
<th align="left">FREQ</th>
<th align="left">MEX</th>
<th align="right">II</th>
<th align="right">EVID</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-01 10:00:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">24</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">2017-01-11 09:15:00</td>
<td align="left">A</td>
<td align="right">0</td>
<td align="left">QD</td>
<td align="left">TRUE</td>
<td align="right">24</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-12 09:15:00</td>
<td align="left">A</td>
<td align="right">0</td>
<td align="left">QD</td>
<td align="left">TRUE</td>
<td align="right">24</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">2017-01-31 08:37:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">24</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb33"><html><body><pre class="r"><span class="fu">get_addl_dosing</span>(<span class="no">ex_dat</span>) <span class="kw">%&gt;%</span> <span class="no">kable</span></pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="right">ID</th>
<th align="left">TIME</th>
<th align="left">TRT</th>
<th align="right">AMT</th>
<th align="left">FREQ</th>
<th align="left">MEX</th>
<th align="right">II</th>
<th align="right">EVID</th>
<th align="right">ADDL</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-01 10:00:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">2017-01-02 08:37:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">24</td>
<td align="right">1</td>
<td align="right">8</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-11 09:15:00</td>
<td align="left">A</td>
<td align="right">0</td>
<td align="left">QD</td>
<td align="left">TRUE</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">2017-01-12 09:15:00</td>
<td align="left">A</td>
<td align="right">0</td>
<td align="left">QD</td>
<td align="left">TRUE</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-13 08:37:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">24</td>
<td align="right">1</td>
<td align="right">17</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">2017-01-31 08:37:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
</div>
<div id="missed-doses-in-sequence-bid" class="section level1">
<h1 class="hasAnchor">
<a href="#missed-doses-in-sequence-bid" class="anchor"></a>Missed doses in sequence, BID</h1>
<p>The first dose record starts the repeated dosing interval for 31 days. But we have 2 missing doses. We should see ADDL dosing starting on <a href="mailto:1/1@8">1/1@8</a>:37pm (the eveing dose) and running for 18 additional doses. Then we have the missed doses recorded on 1/11, at the expected dose times for morning and evening dosing (8am/8pm). Note that we have to enter AMT=0 for the missed dose.</p>
<p>Input Data:</p>
<div class="sourceCode" id="cb34"><html><body><pre class="r"><span class="no">ex_dat</span> <span class="kw">&lt;-</span> <span class="kw pkg">tibble</span><span class="kw ns">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span>(
      ~<span class="no">ID</span>,  ~<span class="no">TIME</span>,           ~<span class="no">TRT</span>, ~<span class="no">AMT</span>,    ~<span class="no">FREQ</span>, ~<span class="no">MEX</span>,   ~<span class="no">II</span>, ~<span class="no">EVID</span>,
      <span class="fl">1</span>,    <span class="st">"01/01/2017 10:00"</span>, <span class="st">"A"</span>,    <span class="fl">100</span>,    <span class="st">"BID"</span>,    <span class="fl">FALSE</span>,   <span class="fl">12</span>,   <span class="fl">1</span>,
      <span class="fl">1</span>,    <span class="st">"01/11/2017 08:00"</span>, <span class="st">"A"</span>,    <span class="fl">0</span>,  <span class="st">"BID"</span>,    <span class="fl">TRUE</span>,   <span class="fl">12</span>,   <span class="fl">1</span>,
      <span class="fl">1</span>,    <span class="st">"01/11/2017 20:00"</span>, <span class="st">"A"</span>,    <span class="fl">0</span>,  <span class="st">"BID"</span>,    <span class="fl">TRUE</span>,   <span class="fl">12</span>,   <span class="fl">1</span>,
      <span class="fl">1</span>,    <span class="st">"01/31/2017 08:37"</span>, <span class="st">"A"</span>,    <span class="fl">100</span>,    <span class="st">"BID"</span>,    <span class="fl">FALSE</span>,   <span class="fl">12</span>,   <span class="fl">1</span>
    ) <span class="kw">%&gt;%</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(
      <span class="kw">TIME</span> <span class="kw">=</span> <span class="fu">iso_to_posix</span>(<span class="no">TIME</span>)
    )
<span class="no">ex_dat</span> <span class="kw">%&gt;%</span> <span class="no">kable</span></pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="right">ID</th>
<th align="left">TIME</th>
<th align="left">TRT</th>
<th align="right">AMT</th>
<th align="left">FREQ</th>
<th align="left">MEX</th>
<th align="right">II</th>
<th align="right">EVID</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-01 10:00:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">BID</td>
<td align="left">FALSE</td>
<td align="right">12</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">2017-01-11 08:00:00</td>
<td align="left">A</td>
<td align="right">0</td>
<td align="left">BID</td>
<td align="left">TRUE</td>
<td align="right">12</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-11 20:00:00</td>
<td align="left">A</td>
<td align="right">0</td>
<td align="left">BID</td>
<td align="left">TRUE</td>
<td align="right">12</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">2017-01-31 08:37:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">BID</td>
<td align="left">FALSE</td>
<td align="right">12</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>Output:</p>
<div class="sourceCode" id="cb35"><html><body><pre class="r"><span class="fu">get_addl_dosing</span>(<span class="no">ex_dat</span>) <span class="kw">%&gt;%</span> <span class="no">kable</span></pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="right">ID</th>
<th align="left">TIME</th>
<th align="left">TRT</th>
<th align="right">AMT</th>
<th align="left">FREQ</th>
<th align="left">MEX</th>
<th align="right">II</th>
<th align="right">EVID</th>
<th align="right">ADDL</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-01 10:00:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">BID</td>
<td align="left">FALSE</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">2017-01-01 20:37:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">BID</td>
<td align="left">FALSE</td>
<td align="right">12</td>
<td align="right">1</td>
<td align="right">18</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-11 08:00:00</td>
<td align="left">A</td>
<td align="right">0</td>
<td align="left">BID</td>
<td align="left">TRUE</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">2017-01-11 20:00:00</td>
<td align="left">A</td>
<td align="right">0</td>
<td align="left">BID</td>
<td align="left">TRUE</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-12 08:37:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">BID</td>
<td align="left">FALSE</td>
<td align="right">12</td>
<td align="right">1</td>
<td align="right">37</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">2017-01-31 08:37:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="left">BID</td>
<td align="left">FALSE</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
</div>
<div id="grouping-by-cmt" class="section level1">
<h1 class="hasAnchor">
<a href="#grouping-by-cmt" class="anchor"></a>Grouping by CMT</h1>
<p>In compartment 1, the first dose record starts the repeated dosing interval. Then we have 3 additional doses leading up to the PK day. We should see ADDL dosing starting on <a href="mailto:1/2@9">1/2@9</a>:15am and running for 8 additional doses. Then the individual doses should show up. It doesn’t matter that they are still marked with II=24… unless there is a large enough gap to restart ADDL sequencing. The second compartment dose starts later in the day on 1/1 and runs BID through the end of the month.</p>
<p>Input Data:</p>
<div class="sourceCode" id="cb36"><html><body><pre class="r"><span class="no">ex_dat</span> <span class="kw">&lt;-</span> <span class="kw pkg">tibble</span><span class="kw ns">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span>(
      ~<span class="no">ID</span>,  ~<span class="no">TIME</span>,           ~<span class="no">CMT</span>, ~<span class="no">AMT</span>,    ~<span class="no">FREQ</span>, ~<span class="no">MEX</span>,   ~<span class="no">II</span>, ~<span class="no">EVID</span>,
      <span class="fl">1</span>,    <span class="st">"01/01/2017 10:00"</span>, <span class="fl">1</span>,  <span class="fl">100</span>,    <span class="st">"QD"</span>,     <span class="fl">FALSE</span>,   <span class="fl">24</span>,   <span class="fl">1</span>,
      <span class="fl">1</span>,    <span class="st">"01/01/2017 15:55"</span>, <span class="fl">2</span>,  <span class="fl">50</span>, <span class="st">"BID"</span>,    <span class="fl">FALSE</span>,   <span class="fl">12</span>,   <span class="fl">1</span>,
      <span class="fl">1</span>,    <span class="st">"01/11/2017 09:15"</span>, <span class="fl">1</span>,  <span class="fl">100</span>,    <span class="st">"QD"</span>,     <span class="fl">FALSE</span>,   <span class="fl">24</span>,   <span class="fl">1</span>,
      <span class="fl">1</span>,    <span class="st">"01/12/2017 10:21"</span>, <span class="fl">1</span>,  <span class="fl">100</span>,    <span class="st">"QD"</span>,     <span class="fl">FALSE</span>,   <span class="fl">24</span>,   <span class="fl">1</span>,
      <span class="fl">1</span>,    <span class="st">"01/13/2017 08:37"</span>, <span class="fl">1</span>,  <span class="fl">100</span>,    <span class="st">"QD"</span>,     <span class="fl">FALSE</span>,   <span class="fl">24</span>,   <span class="fl">1</span>,
      <span class="fl">1</span>,    <span class="st">"01/31/2017 12:43"</span>, <span class="fl">2</span>,  <span class="fl">50</span>, <span class="st">"BID"</span>,    <span class="fl">FALSE</span>,   <span class="fl">12</span>,   <span class="fl">1</span>
    ) <span class="kw">%&gt;%</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(
      <span class="kw">TIME</span> <span class="kw">=</span> <span class="fu">iso_to_posix</span>(<span class="no">TIME</span>)
    )
<span class="no">ex_dat</span> <span class="kw">%&gt;%</span> <span class="no">kable</span></pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="right">ID</th>
<th align="left">TIME</th>
<th align="right">CMT</th>
<th align="right">AMT</th>
<th align="left">FREQ</th>
<th align="left">MEX</th>
<th align="right">II</th>
<th align="right">EVID</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-01 10:00:00</td>
<td align="right">1</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">24</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">2017-01-01 15:55:00</td>
<td align="right">2</td>
<td align="right">50</td>
<td align="left">BID</td>
<td align="left">FALSE</td>
<td align="right">12</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-11 09:15:00</td>
<td align="right">1</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">24</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">2017-01-12 10:21:00</td>
<td align="right">1</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">24</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-13 08:37:00</td>
<td align="right">1</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">24</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">2017-01-31 12:43:00</td>
<td align="right">2</td>
<td align="right">50</td>
<td align="left">BID</td>
<td align="left">FALSE</td>
<td align="right">12</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>As expected, the ADDL dosing fills in between 1/2 and 1/10 only and lines up with 1/11 dose time. For compartment two we get BID dosing ending on 12:43. The sequences compute separately.</p>
<div class="sourceCode" id="cb37"><html><body><pre class="r"><span class="no">ex_dat</span> <span class="kw">%&gt;%</span> <span class="fu">group_by</span>(<span class="no">CMT</span>) <span class="kw">%&gt;%</span> <span class="fu">get_addl_dosing</span>() <span class="kw">%&gt;%</span> <span class="no">kable</span></pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="right">ID</th>
<th align="left">TIME</th>
<th align="right">CMT</th>
<th align="right">AMT</th>
<th align="left">FREQ</th>
<th align="left">MEX</th>
<th align="right">II</th>
<th align="right">EVID</th>
<th align="right">ADDL</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-01 10:00:00</td>
<td align="right">1</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">2017-01-01 15:55:00</td>
<td align="right">2</td>
<td align="right">50</td>
<td align="left">BID</td>
<td align="left">FALSE</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-02 00:43:00</td>
<td align="right">2</td>
<td align="right">50</td>
<td align="left">BID</td>
<td align="left">FALSE</td>
<td align="right">12</td>
<td align="right">1</td>
<td align="right">58</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">2017-01-02 09:15:00</td>
<td align="right">1</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">24</td>
<td align="right">1</td>
<td align="right">8</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-11 09:15:00</td>
<td align="right">1</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">2017-01-12 10:21:00</td>
<td align="right">1</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-13 08:37:00</td>
<td align="right">1</td>
<td align="right">100</td>
<td align="left">QD</td>
<td align="left">FALSE</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">2017-01-31 12:43:00</td>
<td align="right">2</td>
<td align="right">50</td>
<td align="left">BID</td>
<td align="left">FALSE</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
</div>
<div id="expand-addl-records" class="section level1">
<h1 class="hasAnchor">
<a href="#expand-addl-records" class="anchor"></a>Expand ADDL records</h1>
<p>Expand ADDL requires an ID column.</p>
<p>Starting with ADDL dosing records:</p>
<div class="sourceCode" id="cb38"><html><body><pre class="r"><span class="no">ex1</span> <span class="kw">%&gt;%</span> <span class="no">kable</span></pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="right">ID</th>
<th align="left">TIME</th>
<th align="right">AMT</th>
<th align="right">EVID</th>
<th align="right">II</th>
<th align="left">MEX</th>
<th align="right">ADDL</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">2018-01-01 08:15:00</td>
<td align="right">100</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="left">FALSE</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">2018-01-02 10:45:00</td>
<td align="right">100</td>
<td align="right">1</td>
<td align="right">24</td>
<td align="left">FALSE</td>
<td align="right">7</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">2018-01-10 10:45:00</td>
<td align="right">100</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="left">FALSE</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p>we can expand ADDL:</p>
<div class="sourceCode" id="cb39"><html><body><pre class="r"><span class="no">ex1</span> <span class="kw">%&gt;%</span> <span class="fu">expand_addl</span>() <span class="kw">%&gt;%</span> <span class="no">kable</span></pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="right">ID</th>
<th align="left">TIME</th>
<th align="right">AMT</th>
<th align="right">EVID</th>
<th align="right">II</th>
<th align="left">MEX</th>
<th align="right">ADDL</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">2018-01-01 08:15:00</td>
<td align="right">100</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="left">FALSE</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">2018-01-02 10:45:00</td>
<td align="right">100</td>
<td align="right">1</td>
<td align="right">24</td>
<td align="left">FALSE</td>
<td align="right">7</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">2018-01-03 10:45:00</td>
<td align="right">100</td>
<td align="right">1</td>
<td align="right">24</td>
<td align="left">FALSE</td>
<td align="right">-1</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">2018-01-04 10:45:00</td>
<td align="right">100</td>
<td align="right">1</td>
<td align="right">24</td>
<td align="left">FALSE</td>
<td align="right">-1</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">2018-01-05 10:45:00</td>
<td align="right">100</td>
<td align="right">1</td>
<td align="right">24</td>
<td align="left">FALSE</td>
<td align="right">-1</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">2018-01-06 10:45:00</td>
<td align="right">100</td>
<td align="right">1</td>
<td align="right">24</td>
<td align="left">FALSE</td>
<td align="right">-1</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">2018-01-07 10:45:00</td>
<td align="right">100</td>
<td align="right">1</td>
<td align="right">24</td>
<td align="left">FALSE</td>
<td align="right">-1</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">2018-01-08 10:45:00</td>
<td align="right">100</td>
<td align="right">1</td>
<td align="right">24</td>
<td align="left">FALSE</td>
<td align="right">-1</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">2018-01-09 10:45:00</td>
<td align="right">100</td>
<td align="right">1</td>
<td align="right">24</td>
<td align="left">FALSE</td>
<td align="right">-1</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">2018-01-10 10:45:00</td>
<td align="right">100</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="left">FALSE</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p>The expanded records have ADDL set to -1. When using these records with NONMEM be sure to drop II and ADDL or set them to zero.</p>
</div>
<div id="addl-and-time-after-dose" class="section level1">
<h1 class="hasAnchor">
<a href="#addl-and-time-after-dose" class="anchor"></a>ADDL and Time After Dose</h1>
<p>The time_after_dose function takes ADDL into account. With the following data, we expect the TAD for the observation on 1/4 to be 2 hours after the 1/4 dose and not 38 hours after the 1/1 dose.</p>
<pre><code>## Joining, by = "INDEX__"</code></pre>
<pre><code>## Joining, by = c("ID", "DOSENUM__")</code></pre>
<table class="table">
<thead><tr class="header">
<th align="right">ID</th>
<th align="left">TIME</th>
<th align="left">TRT</th>
<th align="right">AMT</th>
<th align="right">II</th>
<th align="right">EVID</th>
<th align="right">ADDL</th>
<th align="right">CRE</th>
<th align="right">TAD</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-01 10:00:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0.3</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">2017-01-01 18:00:00</td>
<td align="left">A</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0.3</td>
<td align="right">8</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-02 10:00:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="right">24</td>
<td align="right">1</td>
<td align="right">8</td>
<td align="right">0.2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">2017-01-04 12:00:00</td>
<td align="left">A</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0.2</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-11 10:00:00</td>
<td align="left">A</td>
<td align="right">100</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0.5</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">2017-01-11 12:00:00</td>
<td align="left">A</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0.5</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">2017-01-11 14:00:00</td>
<td align="left">A</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0.5</td>
<td align="right">4</td>
</tr>
</tbody>
</table>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Jason Chittenden.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
